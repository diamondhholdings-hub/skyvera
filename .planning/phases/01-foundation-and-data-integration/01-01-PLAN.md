---
phase: 01-foundation-and-data-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - .env.example
  - .env.local
  - prisma/schema.prisma
  - src/lib/types/financial.ts
  - src/lib/types/customer.ts
  - src/lib/types/news.ts
  - src/lib/types/result.ts
  - src/lib/types/index.ts
  - src/lib/config/env.ts
  - src/lib/errors/index.ts
autonomous: true
user_setup:
  - service: anthropic
    why: "Claude API for intelligence orchestration"
    env_vars:
      - name: ANTHROPIC_API_KEY
        source: "Anthropic Console -> API Keys -> Create Key (https://console.anthropic.com/settings/keys)"
  - service: newsapi
    why: "Real-time business news intelligence"
    env_vars:
      - name: NEWSAPI_KEY
        source: "NewsAPI.ai -> My Account -> API Key (https://newsapi.ai/account)"

must_haves:
  truths:
    - "Project bootstraps with next dev and compiles without TypeScript errors"
    - "All financial metrics (ARR, EBITDA, Net Margin, Quarterly RR, NRR) have Zod schemas that validate real Skyvera data shapes"
    - "Customer model captures all 140 customer record fields from existing JSON (customer_name, rr, nrr, total, subscriptions, rank, pct_of_total)"
    - "Result type enforces explicit success/error handling at all data boundaries"
    - "Prisma schema defines Customer, Financial, and NewsArticle models with SQLite"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "next"
    - path: "src/lib/types/financial.ts"
      provides: "Zod schemas for all financial metrics"
      exports: ["FinancialMetricsSchema", "QuarterlyRRSchema", "ARRSchema", "BUEnum"]
    - path: "src/lib/types/customer.ts"
      provides: "Zod schemas for customer records"
      exports: ["CustomerSchema", "SubscriptionSchema"]
    - path: "src/lib/types/result.ts"
      provides: "Result/Either type for error handling"
      exports: ["Result", "ok", "err"]
    - path: "prisma/schema.prisma"
      provides: "Database models for SQLite"
      contains: "model Customer"
  key_links:
    - from: "src/lib/types/financial.ts"
      to: "zod"
      via: "z.object schema definitions"
      pattern: "z\\.object"
    - from: "src/lib/types/customer.ts"
      to: "src/lib/types/financial.ts"
      via: "imports financial types for customer financial data"
      pattern: "import.*from.*financial"
---

<objective>
Bootstrap the Next.js TypeScript project and define all core data models, Zod validation schemas, and database schema that every subsequent plan depends on.

Purpose: This is the foundation scaffold. Every other plan in Phase 1 imports types and schemas from here. Without validated type definitions, the semantic layer, Claude orchestrator, and data adapters cannot be built with type safety.

Output: A compilable Next.js project with all TypeScript types, Zod schemas for data validation, Prisma/SQLite database schema, and shared utilities (Result type, error classes, env config).
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-data-integration/01-RESEARCH.md

# Existing data structures to model against
@data/customers_cloudsense_all.json
@data/customers_kandy_all.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bootstrap Next.js project with TypeScript and install all Phase 1 dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    .env.example
    .env.local
    .gitignore
  </files>
  <action>
    Initialize a Next.js 15 project with TypeScript in the current repository root (NOT in a subdirectory -- this IS the project root). Use the App Router.

    Run: `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --use-npm`

    If prompted about existing files, proceed (the existing Python/HTML files should coexist).

    Then install Phase 1 dependencies:
    ```
    npm install zod @anthropic-ai/sdk rate-limiter-flexible date-fns better-sqlite3 prisma
    npm install -D @types/better-sqlite3 @types/node
    ```

    Initialize Prisma with SQLite:
    ```
    npx prisma init --datasource-provider sqlite
    ```

    Create `.env.example` with all required env vars (documented, no real values):
    ```
    ANTHROPIC_API_KEY=your_anthropic_api_key_here
    NEWSAPI_KEY=your_newsapi_key_here
    DATABASE_URL="file:./dev.db"
    ```

    Create `.env.local` with DATABASE_URL only (API keys added by user):
    ```
    DATABASE_URL="file:./dev.db"
    ```

    Update `.gitignore` to include: `.env.local`, `*.db`, `node_modules/`, `.next/`

    Verify `npm run dev` starts without errors, then stop the dev server.
  </action>
  <verify>
    `npm run build` completes without errors. `ls node_modules/.package-lock.json` confirms dependencies installed. `cat prisma/schema.prisma` shows SQLite datasource.
  </verify>
  <done>Next.js 15 project compiles, all Phase 1 npm dependencies installed, Prisma initialized with SQLite, env files created.</done>
</task>

<task type="auto">
  <name>Task 2: Define all TypeScript types, Zod schemas, Prisma models, and shared utilities</name>
  <files>
    src/lib/types/financial.ts
    src/lib/types/customer.ts
    src/lib/types/news.ts
    src/lib/types/result.ts
    src/lib/types/index.ts
    src/lib/config/env.ts
    src/lib/errors/index.ts
    prisma/schema.prisma
  </files>
  <action>
    **src/lib/types/result.ts** -- Result/Either type for explicit error handling:
    ```typescript
    export type Result<T, E = Error> =
      | { success: true; value: T }
      | { success: false; error: E }

    export function ok<T>(value: T): Result<T, never> {
      return { success: true, value }
    }

    export function err<E>(error: E): Result<never, E> {
      return { success: false, error }
    }
    ```

    **src/lib/types/financial.ts** -- Zod schemas for ALL financial metrics. Model against existing data shapes in `data/customers_cloudsense_all.json`. Key schemas:
    - `BUEnum`: z.enum(['Cloudsense', 'Kandy', 'STL', 'NewNet']) -- include NewNet since it exists in data/
    - `QuarterlyRRSchema`: bu, quarterlyRR (number min 0), quarter (string regex Q[1-4]'[0-9]{2})
    - `ARRSchema`: extends QuarterlyRR with arr (derived: quarterlyRR * 4)
    - `FinancialMetricsSchema`: bu, quarterlyRR, arr, nrr, grossMargin (0-100), netMargin (0-100), ebitda, totalRevenue, cogs, headcountCost, vendorCost
    - `BUFinancialSummarySchema`: bu, totalRR, totalNRR, totalRevenue, customerCount, netMarginPct, netMarginTarget, ebitda
    - Export TypeScript types inferred from each schema using z.infer
    - Include a `calculateARR` function: takes quarterlyRR, returns arr = quarterlyRR * 4

    **src/lib/types/customer.ts** -- Zod schemas matching existing JSON structure:
    - `SubscriptionSchema`: sub_id (number), arr (number), renewal_qtr (string), will_renew (string: "Yes"|"No"|"TBD"), projected_arr (number nullable)
    - `CustomerSchema`: customer_name (string), rr (number min 0), nrr (number min 0), total (number min 0), subscriptions (array of SubscriptionSchema), rank (number optional), pct_of_total (number optional)
    - `CustomerWithHealthSchema`: extends CustomerSchema with healthScore (enum: 'green'|'yellow'|'red'), healthFactors (array of strings)
    - `BUCustomerDataSchema`: bu_name (string), total_revenue (number), customer_count (number), customers (array of CustomerSchema)
    - Export inferred TypeScript types

    **src/lib/types/news.ts** -- News article schema:
    - `NewsArticleSchema`: title (string), summary (string), publishedAt (string or Date), source (string), url (string), sentiment (enum: 'positive'|'neutral'|'negative' optional), relevanceScore (number 0-1 optional)
    - `CustomerNewsSchema`: customerName (string), articles (array of NewsArticleSchema), fetchedAt (string), articleCount (number)

    **src/lib/types/index.ts** -- Barrel file re-exporting everything from financial, customer, news, result.

    **src/lib/config/env.ts** -- Environment config with Zod validation:
    ```typescript
    import { z } from 'zod'

    const envSchema = z.object({
      ANTHROPIC_API_KEY: z.string().min(1).optional(),
      NEWSAPI_KEY: z.string().min(1).optional(),
      DATABASE_URL: z.string().default('file:./dev.db'),
      NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),
    })

    export const env = envSchema.parse(process.env)
    ```
    Mark API keys optional so project doesn't crash during development without them. They'll be required at runtime when the orchestrator/adapter is actually called.

    **src/lib/errors/index.ts** -- Custom error classes:
    - `AppError` (base): message, code (string), statusCode (number)
    - `ValidationError` extends AppError: includes zodErrors field
    - `AdapterError` extends AppError: includes adapterName, originalError
    - `RateLimitError` extends AppError: includes retryAfterMs
    - `CacheError` extends AppError

    **prisma/schema.prisma** -- Update with models:
    - `Customer`: id (autoincrement), customerName (string unique), bu (string), rr (Float), nrr (Float), totalRevenue (Float), rank (Int optional), pctOfTotal (Float optional), healthScore (String optional), createdAt, updatedAt
    - `Subscription`: id (autoincrement), customerId (relation to Customer), subId (Float), arr (Float), renewalQtr (String), willRenew (String), projectedArr (Float optional)
    - `FinancialSnapshot`: id (autoincrement), bu (string), quarter (string), totalRR (Float), totalNRR (Float), totalRevenue (Float), grossMargin (Float), netMargin (Float), ebitda (Float), createdAt
    - `NewsArticle`: id (autoincrement), customerName (string), title (string), summary (string), publishedAt (DateTime), source (string), url (string), sentiment (String optional), relevanceScore (Float optional), fetchedAt (DateTime)
    - `CacheEntry`: id (autoincrement), key (string unique), value (string -- JSON serialized), expiresAt (DateTime), createdAt

    After defining schema, run: `npx prisma db push` to create SQLite database.
    Then run: `npx prisma generate` to generate Prisma client.

    Run `npm run build` to verify everything compiles.
  </action>
  <verify>
    `npx tsc --noEmit` passes with zero errors. `npx prisma db push` succeeds. `ls prisma/dev.db` confirms database created. Import `{ CustomerSchema, FinancialMetricsSchema, Result, ok, err }` from barrel file resolves correctly.
  </verify>
  <done>All TypeScript types, Zod schemas, Prisma models, Result type, error classes, and env config exist and compile. Prisma client generated. Any subsequent plan can `import { CustomerSchema, FinancialMetricsSchema } from '@/lib/types'` without errors.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes with zero errors
2. `npx tsc --noEmit` passes (all types compile)
3. `npx prisma db push` succeeds (database schema valid)
4. All Zod schemas can validate sample data from existing `data/customers_cloudsense_all.json`
5. Result type provides type-narrowing: `if (result.success) { result.value }` compiles, `result.error` only accessible in else branch
</verification>

<success_criteria>
- Next.js 15 app bootstrapped with TypeScript, Tailwind, App Router
- All Phase 1 npm dependencies installed (zod, @anthropic-ai/sdk, rate-limiter-flexible, date-fns, better-sqlite3, prisma)
- Zod schemas defined for: FinancialMetrics, Customer, Subscription, NewsArticle, BU data
- Prisma schema with Customer, Subscription, FinancialSnapshot, NewsArticle, CacheEntry models on SQLite
- Result type, custom error classes, and env config available
- Zero TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-data-integration/01-01-SUMMARY.md`
</output>
