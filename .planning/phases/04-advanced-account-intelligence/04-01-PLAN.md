---
phase: 04-advanced-account-intelligence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/types/account-plan.ts
  - src/lib/types/index.ts
  - src/lib/data/server/account-plan-data.ts
  - data/account-plans/stakeholders/british-telecommunications.json
  - data/account-plans/stakeholders/liquid-telecom.json
  - data/account-plans/stakeholders/telefonica-uk.json
  - data/account-plans/stakeholders/spotify.json
  - data/account-plans/stakeholders/att-services.json
  - data/account-plans/strategy/british-telecommunications.json
  - data/account-plans/strategy/liquid-telecom.json
  - data/account-plans/strategy/telefonica-uk.json
  - data/account-plans/strategy/spotify.json
  - data/account-plans/strategy/att-services.json
  - data/account-plans/actions/british-telecommunications.json
  - data/account-plans/actions/liquid-telecom.json
  - data/account-plans/actions/telefonica-uk.json
  - data/account-plans/actions/spotify.json
  - data/account-plans/actions/att-services.json
  - data/account-plans/competitors/british-telecommunications.json
  - data/account-plans/competitors/liquid-telecom.json
  - data/account-plans/competitors/telefonica-uk.json
  - data/account-plans/competitors/spotify.json
  - data/account-plans/competitors/att-services.json
autonomous: true

must_haves:
  truths:
    - "Account plan data schemas are defined with Zod validation for all 7 tab types"
    - "Mock data exists for 5 hero accounts across multiple BUs with realistic business content"
    - "Data access functions load stakeholders, strategy, actions, competitors, intelligence, and news for any account"
    - "Missing data returns empty arrays gracefully (no crashes for accounts without mock data)"
  artifacts:
    - path: "src/lib/types/account-plan.ts"
      provides: "Zod schemas for Stakeholder, PainPoint, Opportunity, ActionItem, Competitor"
      exports: ["StakeholderSchema", "PainPointSchema", "OpportunitySchema", "ActionItemSchema", "CompetitorSchema"]
    - path: "src/lib/data/server/account-plan-data.ts"
      provides: "Data access functions for all account plan tabs"
      exports: ["getAccountPlanData", "getStakeholders", "getStrategyData", "getActionItems", "getCompetitors", "getIntelligenceReport", "getCustomerNews"]
  key_links:
    - from: "src/lib/data/server/account-plan-data.ts"
      to: "data/account-plans/"
      via: "fs.readFile JSON parsing"
      pattern: "readFile.*account-plans"
    - from: "src/lib/data/server/account-plan-data.ts"
      to: "data/intelligence/reports/"
      via: "fs.readFile markdown parsing"
      pattern: "readFile.*intelligence.*reports"
    - from: "src/lib/data/server/account-plan-data.ts"
      to: "data/news/"
      via: "fs.readFile JSON parsing"
      pattern: "readFile.*news"
---

<objective>
Define all account plan types and create the data layer with mock data for 5 hero accounts.

Purpose: Every tab in the 7-tab account plan UI depends on typed data access. This plan creates the Zod schemas, data access functions, and realistic mock data that Plans 04-02 through 04-04 will consume.

Output: TypeScript types, data access module, and 20 mock JSON files for 5 hero accounts.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/types/customer.ts
@src/lib/types/index.ts
@src/lib/types/news.ts
@src/lib/data/server/account-data.ts
@data/intelligence/reports/British_Telecommunications.md
@data/news/Spotify_news.json
@data/customers_cloudsense_all.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define account plan Zod schemas and types</name>
  <files>
    src/lib/types/account-plan.ts
    src/lib/types/index.ts
  </files>
  <action>
Create `src/lib/types/account-plan.ts` with Zod schemas for all account plan data:

1. **StakeholderSchema**: id (string), name (string), title (string), role (enum: 'decision-maker', 'influencer', 'champion', 'user', 'blocker'), raciRole (optional enum: 'responsible', 'accountable', 'consulted', 'informed'), email (optional string), phone (optional string), reportsTo (optional string - parent stakeholder ID for tree), tenure (optional string), interests (optional string array), relationshipStrength (enum: 'strong', 'moderate', 'weak', 'unknown'), lastInteraction (optional string ISO date), notes (optional string).

2. **PainPointSchema**: id (string), title (string), description (string), status (enum: 'active', 'monitoring', 'resolved'), severity (enum: 'high', 'medium', 'low'), identifiedDate (string), owner (optional string).

3. **OpportunitySchema**: id (string), title (string), description (string), status (enum: 'identified', 'exploring', 'proposed', 'won', 'lost'), estimatedValue (optional number), probability (optional number 0-100), identifiedDate (string), owner (optional string).

4. **ActionItemSchema**: id (string), title (string), description (optional string), status (enum: 'todo', 'in-progress', 'done'), priority (enum: 'high', 'medium', 'low'), owner (optional string), dueDate (optional string), createdAt (string).

5. **CompetitorSchema**: id (string), name (string), type (enum: 'our-competitor', 'customer-competitor', 'both'), description (string), strengths (string array), weaknesses (string array), lastUpdated (string).

6. **StrategyDataSchema**: painPoints (array of PainPointSchema), opportunities (array of OpportunitySchema).

7. **IntelligenceReportSchema**: For structured data parsed from existing Markdown reports. Fields: customerName (string), generatedAt (string), summary (string), opportunities (array of {title, description, confidence, estimatedValue?}), risks (array of {title, description, severity, mitigation}), recommendations (array of {title, description, priority, nextSteps?: string[]}).

Export all schemas and their inferred types. Add `export * from './account-plan'` to `src/lib/types/index.ts`.

Use Zod 4 syntax (already in package.json as zod@4.3.6). Follow the existing pattern in customer.ts and financial.ts.
  </action>
  <verify>
Run `npx tsc --noEmit` - zero errors. Grep for all exported schema names in account-plan.ts.
  </verify>
  <done>All 7 schema groups defined with Zod validation, types exported, barrel export updated.</done>
</task>

<task type="auto">
  <name>Task 2: Create data access functions and mock data for 5 hero accounts</name>
  <files>
    src/lib/data/server/account-plan-data.ts
    data/account-plans/stakeholders/british-telecommunications.json
    data/account-plans/stakeholders/liquid-telecom.json
    data/account-plans/stakeholders/telefonica-uk.json
    data/account-plans/stakeholders/spotify.json
    data/account-plans/stakeholders/att-services.json
    data/account-plans/strategy/british-telecommunications.json
    data/account-plans/strategy/liquid-telecom.json
    data/account-plans/strategy/telefonica-uk.json
    data/account-plans/strategy/spotify.json
    data/account-plans/strategy/att-services.json
    data/account-plans/actions/british-telecommunications.json
    data/account-plans/actions/liquid-telecom.json
    data/account-plans/actions/telefonica-uk.json
    data/account-plans/actions/spotify.json
    data/account-plans/actions/att-services.json
    data/account-plans/competitors/british-telecommunications.json
    data/account-plans/competitors/liquid-telecom.json
    data/account-plans/competitors/telefonica-uk.json
    data/account-plans/competitors/spotify.json
    data/account-plans/competitors/att-services.json
  </files>
  <action>
**Part A: Data access functions** in `src/lib/data/server/account-plan-data.ts`:

Create functions that read from JSON files and existing data, with graceful fallback to empty arrays:

1. `slugifyCustomerName(name: string): string` - Convert customer name to file-safe slug. Rules: lowercase, replace spaces with hyphens, remove commas/periods/parentheses, replace `&` with `and`. Examples: "British Telecommunications plc" -> "british-telecommunications-plc", "AT&T SERVICES, INC." -> "att-services-inc", "Liquid Telecom" -> "liquid-telecom". This is used for file lookups only (NOT URL routing).

2. `getStakeholders(customerName: string)` - Read from `data/account-plans/stakeholders/{slug}.json`. Return `Result<Stakeholder[], Error>`. On file not found, return `ok([])` (empty array, not error).

3. `getStrategyData(customerName: string)` - Read from `data/account-plans/strategy/{slug}.json`. Return `Result<StrategyData, Error>`. Default: `{ painPoints: [], opportunities: [] }`.

4. `getActionItems(customerName: string)` - Read from `data/account-plans/actions/{slug}.json`. Return `Result<ActionItem[], Error>`. Default: `ok([])`.

5. `getCompetitors(customerName: string)` - Read from `data/account-plans/competitors/{slug}.json`. Return `Result<Competitor[], Error>`. Default: `ok([])`.

6. `getIntelligenceReport(customerName: string)` - Read from `data/intelligence/reports/{slug}.md` (note: these are MARKDOWN files, not JSON). Parse the markdown into a structured IntelligenceReport. Strategy: Read the raw markdown string. Extract sections using regex or string splitting on `## ` headers. For the demo, return the raw markdown content as a string field alongside any structured data you can extract. Return `Result<{ raw: string, structured?: IntelligenceReport }, Error>`. On file not found, return `ok({ raw: '' })`.

IMPORTANT: The intelligence report filenames use underscores and abbreviated names (e.g., `British_Telecommunications.md`, `Telefonica_UK_Limited.md`, `ATT_Services_Inc.md`). The slugify function needs a SEPARATE mapping or alternate lookup strategy for intelligence reports. Create a `findIntelligenceFile(customerName: string)` helper that tries multiple filename patterns: the slug with underscores, abbreviated forms, etc. Use `fs.readdir` to list available files and find the best match.

7. `getCustomerNews(customerName: string)` - Read from `data/news/{name}_news.json` (note: these use underscores and full customer name with special chars). The existing news JSON format has fields: customer_name, last_updated, article_count, articles[{title, url, source, published, summary, relevance_score}]. Note the `published` field (not `publishedAt`) and `relevance_score` (not `relevanceScore`) - map these to the existing NewsArticle schema or return raw. On file not found, return `ok({ articles: [] })`.

8. `getAccountPlanData(customerName: string)` - Aggregate function that calls all above in parallel with `Promise.all` and returns combined result.

Use `import { readFile, readdir } from 'fs/promises'` and `import path from 'path'`. Follow the Result type pattern from `@/lib/types/result`. Use `process.cwd()` for base path resolution.

**Part B: Mock data for 5 hero accounts** spanning 3 BUs:

Hero accounts (chosen because they have existing intelligence reports and/or news data):
- **British Telecommunications plc** (CloudSense) - Has report + news
- **Liquid Telecom** (CloudSense) - Has report + news
- **Telefonica UK Limited** (CloudSense) - Has report + news
- **Spotify** (CloudSense) - Has report + news
- **AT&T SERVICES, INC.** (Kandy) - Has report, no news

Create JSON files in `data/account-plans/` subdirectories:

**Stakeholder files** (3-5 stakeholders per account in org hierarchy):
- Each account: CEO/CTO at top, 2-3 reports. Use realistic names and titles from the intelligence reports where available (e.g., BT has Allison Kirkby as CEO, Hena Jalil as CIO Business). Include reportsTo relationships for tree building. Mix of role types (decision-maker, influencer, champion). Include RACI roles for 2-3 stakeholders. Vary relationshipStrength across strong/moderate/weak.

**Strategy files** (2-3 pain points + 2-3 opportunities per account):
- Pain points: realistic business challenges (budget pressure, competitive threats, integration complexity). Mix of severities and statuses.
- Opportunities: upsell, expansion, cross-sell aligned with intelligence report content. Include estimatedValue (50K-500K range) and probability (30-80%).

**Action files** (4-6 actions per account across todo/in-progress/done):
- Actions: "Schedule QBR", "Prepare renewal proposal", "Introduce new product features", "Complete security audit". Mix of priorities and statuses. Include owners ("Account Manager", "Solutions Engineer", "Executive Sponsor"). Due dates in Feb-Apr 2026 range.

**Competitor files** (2-3 competitors per account):
- Mix of 'our-competitor' (companies competing with Skyvera for this account) and 'customer-competitor' (the customer's industry rivals). Include 2-3 strengths and weaknesses each. For telecom accounts, competitors could include Amdocs, Oracle CPQ, Salesforce native CPQ (our competitors) and rival telcos (customer competitors).

Use kebab-case filenames matching the slugify function output: `british-telecommunications-plc.json`, `liquid-telecom.json`, `telefonica-uk-limited.json`, `spotify.json`, `att-services-inc.json`.
  </action>
  <verify>
Run `npx tsc --noEmit` - zero errors. Verify mock data files exist: `ls data/account-plans/stakeholders/ data/account-plans/strategy/ data/account-plans/actions/ data/account-plans/competitors/`. Each directory should have 5 JSON files. Verify each JSON file is valid: `node -e "const fs=require('fs');const files=require('child_process').execSync('find data/account-plans -name *.json').toString().trim().split('\n');files.forEach(f=>{try{JSON.parse(fs.readFileSync(f));console.log('OK:',f)}catch(e){console.error('FAIL:',f,e.message)}})"`.
  </verify>
  <done>Data access functions load all account plan data types with graceful empty fallbacks. 20 mock JSON files exist (5 accounts x 4 data types) with realistic business content. TypeScript compiles without errors.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. All Zod schemas export correctly from `@/lib/types`
3. 20 mock JSON files exist across 4 subdirectories in `data/account-plans/`
4. Data access functions handle missing files gracefully (return empty arrays, not errors)
5. Intelligence report reader can load at least one existing .md file from `data/intelligence/reports/`
6. News reader can load at least one existing .json file from `data/news/`
</verification>

<success_criteria>
- All account plan types defined with Zod schemas
- Data access layer loads and validates data for all 7 tab types
- 5 hero accounts have complete mock data
- Accounts without mock data get empty arrays (graceful degradation)
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/04-advanced-account-intelligence/04-01-SUMMARY.md`
</output>
