---
phase: 04-advanced-account-intelligence
plan: 04
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - src/app/accounts/[name]/_components/action-items-tab.tsx
  - src/app/accounts/[name]/_components/action-card.tsx
  - src/app/accounts/[name]/_components/kanban-column.tsx
  - src/app/accounts/[name]/_components/quick-add-action.tsx
  - src/app/accounts/[name]/page.tsx
autonomous: true

must_haves:
  truths:
    - "User sees Kanban board with 3 columns: To Do, In Progress, Done"
    - "User can drag action cards between columns to update status"
    - "User sees color-coded priority badges (High=red, Medium=yellow, Low=green) with accessible icons"
    - "User can quick-add new actions directly in a column"
    - "User sees action card details: title, owner, due date, priority"
    - "Drag interaction provides instant visual feedback (card follows cursor, drop target highlights)"
  artifacts:
    - path: "src/app/accounts/[name]/_components/action-items-tab.tsx"
      provides: "Kanban board with DndContext and 3 columns"
      exports: ["ActionItemsTab"]
    - path: "src/app/accounts/[name]/_components/action-card.tsx"
      provides: "Draggable action card with priority badges"
      exports: ["ActionCard", "SortableActionCard"]
    - path: "src/app/accounts/[name]/_components/kanban-column.tsx"
      provides: "Droppable column with sortable context"
      exports: ["KanbanColumn"]
    - path: "src/app/accounts/[name]/_components/quick-add-action.tsx"
      provides: "Inline action creation form"
      exports: ["QuickAddAction"]
  key_links:
    - from: "src/app/accounts/[name]/_components/action-items-tab.tsx"
      to: "@dnd-kit/core"
      via: "DndContext, DragOverlay"
      pattern: "DndContext|DragOverlay"
    - from: "src/app/accounts/[name]/_components/kanban-column.tsx"
      to: "@dnd-kit/sortable"
      via: "SortableContext"
      pattern: "SortableContext"
    - from: "src/app/accounts/[name]/page.tsx"
      to: "ActionItemsTab"
      via: "conditional tab rendering"
      pattern: "action-items.*ActionItemsTab"
---

<objective>
Build the Action Items tab with a drag-and-drop Kanban board using @dnd-kit.

Purpose: This is the most interactive tab, requiring drag-and-drop state management. Satisfies ACCT-06 (manage action plans per account with ownership and due dates).

Output: Kanban board at `/accounts/[name]?tab=action-items` with drag-and-drop between To Do / In Progress / Done columns.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-advanced-account-intelligence/04-01-SUMMARY.md
@.planning/phases/04-advanced-account-intelligence/04-02-SUMMARY.md
@src/app/accounts/[name]/page.tsx
@src/lib/types/account-plan.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @dnd-kit and build Kanban board components</name>
  <files>
    src/app/accounts/[name]/_components/action-items-tab.tsx
    src/app/accounts/[name]/_components/action-card.tsx
    src/app/accounts/[name]/_components/kanban-column.tsx
    src/app/accounts/[name]/_components/quick-add-action.tsx
  </files>
  <action>
**First: Install dependencies**
```
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

Do NOT install @dnd-kit/react (unstable 0.x pre-release).

**1a. ActionCard** (`action-card.tsx`) - "use client":

Two exports: `ActionCard` (for DragOverlay) and `SortableActionCard` (wrapped with useSortable).

**ActionCard** props: `action: ActionItem`, `isDragging?: boolean`
- Card: `bg-white p-3 rounded shadow` (add `opacity-50` when isDragging)
- Top row: title (font-medium text-sm flex-1) + priority badge
- Priority badges with accessible icons (lucide-react):
  - High: `bg-red-100 text-red-800` + AlertCircle icon + "High" text
  - Medium: `bg-yellow-100 text-yellow-800` + Minus icon + "Medium" text
  - Low: `bg-green-100 text-green-800` + CheckCircle icon + "Low" text
  - Include `aria-label={\`Priority: \${priority}\`}` on badge span
- Owner line (if present): text-xs text-slate-600 with User icon
- Due date (if present): text-xs text-slate-600 with Calendar icon
  - Color due date red if past due (new Date(dueDate) < new Date())
  - Use date-fns `format(new Date(dueDate), 'MMM d, yyyy')` for display

**SortableActionCard** - wraps ActionCard with useSortable:
- `const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({ id: action.id })`
- Apply CSS.Transform.toString(transform) and transition as inline styles
- Spread {...attributes} and {...listeners} on the wrapper div
- Pass `isDragging` from useSortable to ActionCard

**1b. KanbanColumn** (`kanban-column.tsx`) - "use client":

Props: `id: string` (column status: 'todo' | 'in-progress' | 'done'), `title: string`, `actions: ActionItem[]`, `onQuickAdd: (title: string, status: string) => void`

- Container: `bg-slate-100 p-4 rounded-lg min-h-[200px]` (min-height so empty columns are still drop targets)
- Header: title (font-semibold) + count badge (text-sm text-slate-500)
- QuickAddAction component at top
- SortableContext wrapping the action cards: `items={actions.map(a => a.id)}`, `strategy={verticalListSortingStrategy}`
- Action cards rendered in a `space-y-3` div

Use `useDroppable` from @dnd-kit/core on the column container so cards can be dropped into empty columns. The droppable id should be the column status string.

**1c. QuickAddAction** (`quick-add-action.tsx`) - "use client":

Props: `columnStatus: string`, `onAdd: (title: string) => void`

- Default state: `+ Add action` dashed border button (text-sm text-slate-600 border-2 border-dashed rounded p-2 hover:border-slate-400 w-full)
- Clicked state: Input field (autoFocus) + Add button + Cancel button
- Enter key on input triggers add
- Escape key cancels
- After add: clear input, stay in add mode (ready for next item)
- Add calls onAdd with title string

**1d. ActionItemsTab** (`action-items-tab.tsx`) - "use client":

Props: `initialActions: ActionItem[]`

State: `actions` (useState, initialized from props), `activeId` (for DragOverlay)

DndContext setup:
- Import: `DndContext, DragOverlay, closestCorners, pointerWithin, rectIntersection` from @dnd-kit/core
- Use `closestCorners` as collision detection (works best for Kanban layouts)
- `onDragStart`: set activeId
- `onDragEnd`: determine which column the card was dropped on. Logic:
  1. Get the `over` element. It could be another card (in which case, find its column) or the column droppable itself.
  2. Find the new status: if `over.id` is 'todo', 'in-progress', or 'done', use that directly. Otherwise, find the action with `over.id` and use its status.
  3. Update the dragged action's status in state.
  4. Clear activeId.
- `onDragCancel`: clear activeId

Columns: 3 KanbanColumns for 'todo', 'in-progress', 'done' with titles "To Do", "In Progress", "Done"

DragOverlay: When activeId is set, render an ActionCard with the matching action and isDragging=true. This provides a floating preview while dragging.

Quick add handler: Create a new ActionItem with `crypto.randomUUID()` id, provided title, column status, 'medium' default priority, current ISO date as createdAt. Add to actions state.

Layout: `grid md:grid-cols-3 gap-6`

**Empty state:** If initialActions is empty, show the 3 columns with "No action items yet" message in the first column.

**Summary bar at bottom:** Total items count, breakdown by priority (X High, Y Medium, Z Low), breakdown by status.

For the demo: all state changes are client-side only (not persisted to disk). This is stated in the context decisions as acceptable.
  </action>
  <verify>
Run `npx tsc --noEmit` - zero errors. Navigate to `/accounts/British%20Telecommunications%20plc?tab=action-items`. Verify 3 Kanban columns render. Verify action cards show priority badges with icons. Drag a card from To Do to In Progress - verify it moves. Click "+ Add action", type a title, press Enter - verify new card appears. Verify empty columns are valid drop targets. Navigate to a non-hero account and verify empty Kanban board renders.
  </verify>
  <done>Kanban board renders with 3 columns. Drag-and-drop moves cards between columns. Priority badges use color + icon for accessibility. Quick-add creates new action items. Empty states handled gracefully.</done>
</task>

<task type="auto">
  <name>Task 2: Wire Action Items tab into page and final verification</name>
  <files>
    src/app/accounts/[name]/page.tsx
  </files>
  <action>
Update `src/app/accounts/[name]/page.tsx` to:

1. Replace the 'action-items' placeholder with the actual ActionItemsTab component:
   `{activeTab === 'action-items' && <ActionItemsTab initialActions={planData.actionItems} />}`

2. Import ActionItemsTab from `./_components/action-items-tab`

3. Verify ALL 7 tabs are now wired in (no more placeholder divs):
   - overview -> OverviewTab
   - financials -> FinancialsTab
   - organization -> OrganizationTab
   - strategy -> StrategyTab
   - competitive -> CompetitiveTab
   - intelligence -> IntelligenceTab
   - action-items -> ActionItemsTab

4. Ensure the page properly passes `planData.actionItems` (or equivalent) from the getAccountPlanData result to the ActionItemsTab.

5. Quick sanity check: verify the page still handles the case where all data functions return empty arrays (non-hero accounts). Every tab should have empty state handling.
  </action>
  <verify>
Run `npx tsc --noEmit` - zero errors. Run `npm run build` to verify full production build passes. Navigate through all 7 tabs on a hero account (British Telecommunications plc) and verify each renders content. Navigate through all 7 tabs on a non-hero account and verify each shows appropriate empty state. Verify no console errors in browser.
  </verify>
  <done>All 7 tabs wired and functional. Full production build passes. Hero accounts show rich data across all tabs. Non-hero accounts show graceful empty states. Phase 4 requirements ACCT-04 through ACCT-10 satisfied.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` passes (production build)
3. @dnd-kit packages installed and working with React 19
4. Kanban board renders 3 columns with drag-and-drop
5. Action cards show accessible priority badges
6. Quick-add creates new action items
7. All 7 tabs functional (no placeholders remaining)
8. Hero accounts show full data on every tab
9. Non-hero accounts show empty states on every tab
10. No console errors during tab navigation
</verification>

<success_criteria>
- Users can manage action plans with Kanban drag-and-drop (ACCT-06)
- All 7 tabs of account plan interface fully functional (ACCT-09 complete)
- Priority badges use color + accessible icons (WCAG 2.2 Level AA)
- Quick-add and status changes work via drag-and-drop
- Production build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-advanced-account-intelligence/04-04-SUMMARY.md`
</output>
