---
phase: 05-demo-readiness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/global-error.tsx
  - src/app/not-found.tsx
  - src/app/dashboard/error.tsx
  - src/app/accounts/error.tsx
  - src/app/accounts/[name]/error.tsx
  - src/app/alerts/error.tsx
  - src/app/query/error.tsx
  - src/app/scenario/error.tsx
  - src/components/ui/empty-state.tsx
autonomous: true

must_haves:
  truths:
    - "When Claude API times out, user sees business-friendly message instead of white screen or stack trace"
    - "When any route segment throws, user sees contextual error with 'Try again' button that calls reset()"
    - "When account has no data for a tab, user sees polished empty state with clear messaging"
  artifacts:
    - path: "src/app/global-error.tsx"
      provides: "Root-level error boundary for catastrophic failures"
      contains: "'use client'"
    - path: "src/app/dashboard/error.tsx"
      provides: "Dashboard-specific error boundary"
      contains: "Data temporarily unavailable"
    - path: "src/app/accounts/[name]/error.tsx"
      provides: "Account plan error boundary with API failure detection"
      contains: "reset()"
    - path: "src/components/ui/empty-state.tsx"
      provides: "Reusable empty state component with icon, title, description, CTA"
      contains: "EmptyState"
  key_links:
    - from: "src/app/accounts/[name]/error.tsx"
      to: "error boundary API"
      via: "error.message inspection for 429/timeout detection"
      pattern: "error\\.message"
    - from: "src/components/ui/empty-state.tsx"
      to: "account plan tabs"
      via: "import and render in tab components"
      pattern: "EmptyState"
---

<objective>
Add error boundaries to every route segment and create polished empty states for missing data scenarios.

Purpose: Prevent white screens and technical error messages during demo. When Claude API, NewsAPI, or data loading fails, users see business-friendly fallback UI with recovery options. When accounts lack data for specific tabs, users see intentional empty states rather than blank space.

Output: error.tsx files at every route segment, global-error.tsx for catastrophic failures, not-found.tsx for 404s, and a reusable EmptyState component.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-demo-readiness/05-CONTEXT.md
@.planning/phases/05-demo-readiness/05-RESEARCH.md
@src/app/layout.tsx
@src/app/dashboard/page.tsx
@src/app/accounts/[name]/page.tsx
@src/lib/errors/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Error boundaries for all route segments</name>
  <files>
    src/app/global-error.tsx
    src/app/not-found.tsx
    src/app/dashboard/error.tsx
    src/app/accounts/error.tsx
    src/app/accounts/[name]/error.tsx
    src/app/alerts/error.tsx
    src/app/query/error.tsx
    src/app/scenario/error.tsx
  </files>
  <action>
    Create error.tsx files for EVERY route segment. Each must be a 'use client' component that receives {error, reset} props.

    For each error boundary:
    1. Log error to console (console.error) for debugging
    2. Detect error type by inspecting error.message:
       - Contains "429" or "rate limit" -> "High demand right now" message
       - Contains "timeout" or "Claude" -> "Data temporarily unavailable" message
       - Contains "ECONNREFUSED" or "fetch" -> "Service temporarily offline" message
       - Default -> "Something went wrong" message
    3. Show a "Try again" button that calls reset()
    4. Show a navigation link back to parent page (e.g., "Return to Accounts" from account plan error)
    5. Use lucide-react AlertCircle icon for visual indicator
    6. Use yellow-500 color for warning icon, slate-900 for heading, gray-600 for description text
    7. Center content vertically with min-h-[400px]

    For global-error.tsx specifically:
    - Must include its own html and body tags (Next.js requirement for global error)
    - Provide "Return to Dashboard" link
    - Use simpler styling (no Tailwind utilities that might not load)

    For not-found.tsx:
    - Show "Page not found" with link back to dashboard
    - Use lucide-react FileQuestion icon

    Language rules (from CONTEXT.md):
    - NEVER show technical errors to users (no "TypeError", no "500", no stack traces)
    - Use: "Data temporarily unavailable", "High demand right now", "Unable to load"
    - NEVER use: "API timeout error", "Service unavailable", "Internal server error"
  </action>
  <verify>
    Run `find src/app -name "error.tsx" | wc -l` should return 6 (dashboard, accounts, accounts/[name], alerts, query, scenario).
    Run `ls src/app/global-error.tsx src/app/not-found.tsx` should succeed.
    Run `npx tsc --noEmit` should pass with no type errors.
  </verify>
  <done>
    Every route segment has an error.tsx with business-friendly messaging, reset() button, and navigation fallback. Global error and 404 pages exist.
  </done>
</task>

<task type="auto">
  <name>Task 2: Reusable EmptyState component and integration</name>
  <files>
    src/components/ui/empty-state.tsx
  </files>
  <action>
    Create a reusable EmptyState component at src/components/ui/empty-state.tsx:

    Props interface:
    - icon?: React.ReactNode (default: lucide-react FileQuestion, h-12 w-12, text-gray-400)
    - title: string (required)
    - description: string (required)
    - action?: { label: string; onClick?: () => void; href?: string } (optional CTA)

    Styling:
    - flex flex-col items-center justify-center
    - min-h-[300px] space-y-4 p-8
    - bg-gray-50 rounded-lg border-2 border-dashed border-gray-300
    - Title: text-lg font-semibold text-gray-900
    - Description: text-sm text-gray-600 max-w-md text-center
    - Action button: flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700
    - If action.href provided, render as Link instead of button

    This is a shared component. Do NOT modify any tab components in this task -- the empty state component just needs to exist and export correctly. Tab components will use it naturally when they have no data (they already handle empty arrays from account-plan-data.ts).
  </action>
  <verify>
    Run `npx tsc --noEmit` should pass.
    Verify the component exports: `grep -n "export function EmptyState" src/components/ui/empty-state.tsx` should match.
  </verify>
  <done>
    EmptyState component exists at src/components/ui/empty-state.tsx with icon, title, description, and optional CTA action. Exports correctly and type-checks clean.
  </done>
</task>

</tasks>

<verification>
- `find src/app -name "error.tsx" | wc -l` returns 6
- `ls src/app/global-error.tsx src/app/not-found.tsx` succeeds
- `grep -r "reset()" src/app/*/error.tsx` shows reset button in every error boundary
- `grep -r "'use client'" src/app/*/error.tsx` shows client directive in every error boundary
- `npx tsc --noEmit` passes
</verification>

<success_criteria>
Every route segment (dashboard, accounts, accounts/[name], alerts, query, scenario) has an error.tsx with business-friendly error messages, recovery button, and navigation fallback. Global error handler and 404 page exist. EmptyState component ready for use across tabs.
</success_criteria>

<output>
After completion, create `.planning/phases/05-demo-readiness/05-01-SUMMARY.md`
</output>
