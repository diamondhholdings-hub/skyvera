# Codebase Structure

**Analysis Date:** 2026-02-08

## Directory Layout

```
/Users/RAZER/Documents/projects/Skyvera/
├── scripts/                        # Python extraction, transformation, generation scripts
├── data/                           # Input and intermediate data (JSON, markdown, prompts)
│   ├── customers_*.json            # Customer revenue data by BU (extracted from Excel)
│   ├── intelligence/               # AI-generated intelligence and prompts
│   │   ├── prompts/                # Customer intelligence prompts (template inputs for AI)
│   │   └── reports/                # Generated markdown intelligence reports
│   ├── news/                       # Customer news data (fetched from OSINT sources)
│   └── intelligence_html.json      # Pre-rendered HTML sections from intelligence reports
├── output/                         # Generated HTML dashboards
│   ├── *.html                      # CloudSense customer account plan dashboards
│   ├── kandy/                      # Kandy BU dashboards
│   ├── stl/                        # STL BU dashboards
│   └── newnet/                     # NewNet BU dashboards
├── templates/                      # HTML template(s) for dashboard generation
│   └── account_plan_base.html      # Base tabbed account plan template
├── docs/                           # Design documents and implementation plans
│   └── plans/                      # Phase planning documents
├── .planning/                      # GSD orchestration directory
│   └── codebase/                   # Generated analysis documents (ARCHITECTURE.md, STRUCTURE.md, etc.)
└── [Excel source]                  # Master budget workbook
    2025-12-11 Skyvera - Budget - Q1'26 - For Todd.xlsx
```

## Directory Purposes

**scripts/:**
- Purpose: All data extraction, transformation, intelligence generation, and dashboard rendering logic
- Contains: 28+ Python scripts organized by function (extract_*, generate_*, fetch_*, etc.)
- Key scripts: `generate_tabbed_dashboards.py` (primary dashboard generator), `create_full_dashboard.py` (full-featured generator), `fetch_customer_news.py` (OSINT news)

**data/:**
- Purpose: Central repository for all processed data (JSON), generated intelligence (markdown), and cached assets
- Contains: Customer datasets by BU, intelligence reports, news archives, transformation output
- Generated by: Extraction and transformation scripts
- Consumed by: Dashboard generation scripts

**data/intelligence/prompts/:**
- Purpose: AI prompt templates for customer intelligence generation
- Contains: One TXT file per customer with structured prompt asking AI to research customer
- Format: Plain text with sections for Company Intelligence, Executives, Strategic Initiatives, etc.
- Generated by: `scripts/generate_intelligence_prompts_all_bus.py`, `scripts/generate_customer_intelligence.py`

**data/intelligence/reports/:**
- Purpose: AI-generated strategic account intelligence in markdown format
- Contains: One MD file per customer with comprehensive research (executives, org structure, strategic priorities)
- Format: Markdown with structured sections, tables, risk assessments
- Generated by: External AI agents (invoked by Python scripts)
- Consumed by: Dashboard generators (extract sections for tab content)

**data/news/:**
- Purpose: Cached customer news from OSINT sources (Google News API, etc.)
- Contains: One JSON file per customer with article metadata, relevance scores, publication dates
- Generated by: `scripts/fetch_customer_news.py`
- Refreshed by: `scripts/daily_news_update.sh` (daily scheduled job)

**output/:**
- Purpose: Generated HTML dashboards ready for web browser viewing (no server required)
- Contains: 140+ standalone HTML files (one per customer per BU)
- Organization: Root level for CloudSense, subdirectories for other BUs (kandy/, stl/, newnet/)
- Generated by: `scripts/generate_tabbed_dashboards.py`, `scripts/create_full_dashboard.py`
- Serves as: Final deliverable for end-users (opened directly in browser)

**templates/:**
- Purpose: HTML template base for dashboard generation
- Contains: Single template file with Jinja-like placeholders, Chart.js configuration, CSS/JavaScript
- Format: HTML5 with embedded CSS, JavaScript (no external framework)
- Variables substituted: Customer name, revenue data, intelligence sections, executive information
- Generated by: Dashboard generators via string substitution

**docs/plans/:**
- Purpose: Implementation plans and design documentation for features
- Contains: Phase plans, feature specs, architectural decisions
- Examples: `2026-02-03-customer-account-plan-system.md`, `2026-02-04-scenario-planning-design.md`

## Key File Locations

**Entry Points:**

| File | Purpose |
|------|---------|
| `scripts/generate_tabbed_dashboards.py` | Primary dashboard generation for all BUs (generates 140+ HTML files) |
| `scripts/create_full_dashboard.py` | Advanced dashboard generator with full intelligence integration |
| `scripts/fetch_customer_news.py` | News fetching from OSINT sources |
| `scripts/generate_customer_intelligence.py` | Generate intelligence prompts for AI agents |
| `scripts/generate_index.py` | Generate master index page with customer selector |
| `scripts/update_all_dashboards.sh` | Bash orchestration script for full pipeline |

**Configuration:**

| File | Purpose |
|------|---------|
| `2025-12-11 Skyvera - Budget - Q1'26 - For Todd.xlsx` | Single source of truth for all customer revenue data |
| `CLAUDE.md` | Project context and instructions for Claude Code agents |

**Core Logic:**

| File | Purpose |
|------|---------|
| `scripts/generate_tabbed_dashboards.py` | 781 lines: Main dashboard renderer, tab content parsing |
| `scripts/create_full_dashboard.py` | 787 lines: Full-featured dashboard generator with section extraction |
| `scripts/generate_dashboards.py` | 667 lines: Base dashboard generator (legacy, superceded by tabbed version) |
| `scripts/fetch_customer_news.py` | 144 lines: News fetching, relevance scoring, deduplication |
| `scripts/generate_customer_intelligence.py` | 175 lines: Prompt generation for AI agents |

**Testing:**

| File | Purpose |
|------|---------|
| `analyze_customers.py` | Ad-hoc script to validate Excel data structure |
| `check_rr_structure.py` | Script to inspect RR Input sheet layout |
| `comprehensive_customer_analysis.py` | Full customer data analysis and validation |

## Naming Conventions

**Files:**

- **Extraction scripts:** `extract_*.py` (e.g., `extract_all_customers.py`, `extract_kandy_customers.py`)
- **Generation scripts:** `generate_*.py` (e.g., `generate_dashboards.py`, `generate_intelligence_prompts.py`)
- **Utility scripts:** Descriptive names (e.g., `fetch_customer_news.py`, `add_region_to_customers.py`)
- **Data files:** `customers_*.json` (e.g., `customers_cloudsense_all.json`), `intelligence_html.json`
- **Dashboard output:** `{customer_name}.html` (spaces/slashes converted to underscores)
- **Intelligence reports:** `{customer_name}.md` (spaces/slashes converted to underscores)
- **News files:** `{customer_name}_news.json`

**Directories:**

- **Script collection:** `scripts/`
- **Data collection:** `data/`, `data/intelligence/`, `data/news/`
- **Output collection:** `output/`, with BU-specific subdirectories (`kandy/`, `stl/`, `newnet/`)
- **Template collection:** `templates/`

**Code Style:**

- Functions use `snake_case` (e.g., `load_customers()`, `parse_action_items()`, `extract_section_from_markdown()`)
- Variables use `snake_case` (e.g., `customer_name`, `rr_data`, `bu_files`)
- Constants/mappings use `UPPER_SNAKE_CASE` (uncommon in current codebase, but seen in template CSS custom properties)

## Where to Add New Code

**New Feature (e.g., export to PDF):**
- Primary code: `scripts/generate_pdf_export.py`
- Tests: Ad-hoc validation script (no formal test framework)
- Data: Store outputs in `output/pdfs/` subdirectory

**New Business Unit:**
- Customer extraction: `scripts/extract_{bu_name}_customers.py` (copy/modify from `extract_kandy_customers.py`)
- Dashboard generation: `scripts/generate_dashboards_{bu_name}.py`
- Index page: `scripts/generate_index_{bu_name}.py`
- Output directory: Create `output/{bu_name}/` subdirectory
- Data file: `data/customers_{bu_name}_all.json`

**New Dashboard Section/Tab:**
- Add markdown section to intelligence report template (in AI prompt)
- Add parsing logic in `create_full_dashboard.py` or `generate_tabbed_dashboards.py` (extract_section_from_markdown())
- Add tab definition in HTML template (`templates/account_plan_base.html`)
- Add corresponding Chart.js or HTML rendering logic in JavaScript section

**Utilities/Helpers:**
- Shared functions across multiple scripts: Keep in-script or create `scripts/shared_utils.py`
- Data loading functions: `load_customers()`, `load_intelligence_data()` — found in multiple scripts, pattern is to duplicate (not DRY)

**Configuration Changes:**
- BU mappings: In script's `bu_files` dict (e.g., `generate_tabbed_dashboards.py` line 10-15)
- Column mappings for Excel: Hard-coded indices in extraction scripts (e.g., `row[0]=BU`, `row[1]=customer_name`)
- News sources: Modify `CustomerNewsFetcher` class in `fetch_customer_news.py`

## Special Directories

**output/:**
- Purpose: Generated dashboards (final deliverable)
- Generated: Yes (recreated on each generation run)
- Committed: Yes (checked into git for distribution)
- Contains: 140+ HTML files representing accounts across all 4 BUs

**data/intelligence/reports/:**
- Purpose: AI-generated intelligence reports
- Generated: Yes (AI agents create these, not human-authored)
- Committed: Yes (cached for dashboard generation)
- Update frequency: As needed when intelligence needs refreshing

**.planning/:**
- Purpose: GSD orchestration and analysis documents
- Generated: Yes (created by GSD agents)
- Committed: Yes (tracked in git)
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, etc.

**data/news/:**
- Purpose: Cached OSINT news data
- Generated: Yes (fetched from APIs)
- Committed: Partial (recent data, may not include full archive)
- Update frequency: Daily via `daily_news_update.sh`

---

*Structure analysis: 2026-02-08*
